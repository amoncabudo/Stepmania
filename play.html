<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joc Interactiu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Asegúrate de que la ruta al CSS sea correcta -->
    <link rel="stylesheet" href="src/CSS/style.css">   
</head>
<body class="gamebody">
    <header class="header">
        <a href="#" class="logo">ᚠ</a>
        <a href="index.html" class="home-button"><ion-icon name="home"></ion-icon></a>
    </header>

    <div class="game-container">
        <h1 class="game-title">Joc Interactiu</h1>
        <p>Prem les tecles de direcció quan apareguin en pantalla!</p>
    
        <div id="gameStatus">Prem ENTER per començar el joc!</div>
        <div id="elementsContainer"></div>
    </div>

    <script>
        class Game {
            constructor() {
                this.elements = [];
                this.activeElements = new Set();
                this.score = 0;
                this.startTime = null;
                this.elementsContainer = document.getElementById('elementsContainer');
                this.gameStatus = document.getElementById('gameStatus');
                this.isGameStarted = false;
            }

            init() {
                // Mostrar mensaje inicial
                this.gameStatus.textContent = 'Prem ENTER per començar el joc!';
                
                // Agregar event listener para la tecla Enter
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !this.isGameStarted) {
                        this.startGame();
                    }
                });
            }

            startGame() {
                this.isGameStarted = true;
                // Datos de juego de ejemplo
                const gameData = `4
37 # 0.5 # 1.5
38 # 1.0 # 2.0
39 # 1.5 # 2.5
40 # 2.0 # 3.0`;
    
                this.loadGameData(gameData);
                this.start();
            }

            loadGameData(data) {
                const lines = data.trim().split('\n');
                const numElements = parseInt(lines[0]);
                
                for (let i = 1; i <= numElements; i++) {
                    const [keyCode, startTime, endTime] = lines[i].split('#').map(s => s.trim());
                    this.elements.push({
                        keyCode: parseInt(keyCode),
                        startTime: parseFloat(startTime),
                        endTime: parseFloat(endTime),
                        color: this.getRandomColor(),
                    });
                }
            }

            start() {
                this.startTime = Date.now();
                this.gameLoop();
                
                document.addEventListener('keydown', (e) => {
                    const key = e.keyCode;
                    if (this.activeElements.has(key)) {
                        this.handleKeyPress(key);
                    }
                });
    
                this.gameStatus.textContent = 'Joc iniciat! Prem les tecles quan apareguin';
            }

            gameLoop() {
                if (!this.isGameStarted) return;
                
                const currentTime = (Date.now() - this.startTime) / 1000;
                
                this.elementsContainer.innerHTML = '';
                this.activeElements.clear();
    
                this.elements.forEach(element => {
                    if (currentTime >= element.startTime && currentTime <= element.endTime) {
                        this.activeElements.add(element.keyCode);
                        this.createVisualElement(element);
                    }
                });
    
                if (currentTime <= this.elements[this.elements.length - 1].endTime) {
                    requestAnimationFrame(() => this.gameLoop());
                } else {
                    this.endGame();
                }
            }

            createVisualElement(element) {
                const div = document.createElement('div');
                div.className = 'element';
                div.style.backgroundColor = element.color;
                
                // Centrar el elemento dentro del contenedor
                div.style.position = 'absolute';
                div.style.left = '50%';
                div.style.top = '50%';
                div.style.transform = 'translate(-50%, -50%)';

                switch(element.keyCode) {
                    case 37:
                        div.innerHTML = '<i class="fas fa-arrow-left"></i>';
                        break;
                    case 38:
                        div.innerHTML = '<i class="fas fa-arrow-up"></i>';
                        break;
                    case 39:
                        div.innerHTML = '<i class="fas fa-arrow-right"></i>';
                        break;
                    case 40:
                        div.innerHTML = '<i class="fas fa-arrow-down"></i>';
                        break;
                }
                
                this.elementsContainer.appendChild(div);
            }

            handleKeyPress(keyCode) {
                this.score += 10;
                this.gameStatus.textContent = `Puntuació: ${this.score} - Molt bé!`;
                
                const elements = document.getElementsByClassName('element');
                for (let element of elements) {
                    if (
                        (keyCode === 37 && element.innerHTML.includes('fa-arrow-left')) ||
                        (keyCode === 38 && element.innerHTML.includes('fa-arrow-up')) ||
                        (keyCode === 39 && element.innerHTML.includes('fa-arrow-right')) ||
                        (keyCode === 40 && element.innerHTML.includes('fa-arrow-down'))
                    ) {
                        element.style.transform = 'translate(-50%, -50%) scale(1.2)';
                        element.style.backgroundColor = '#4CAF50';
                        setTimeout(() => {
                            element.style.transform = 'translate(-50%, -50%) scale(1)';
                        }, 100);
                    }
                }
            }

            endGame() {
                this.isGameStarted = false;
                this.gameStatus.textContent = `Joc acabat! Puntuació final: ${this.score}. Prem ENTER per tornar a jugar!`;
                setTimeout(() => {
                    alert(`Joc acabat! Has aconseguit ${this.score} punts!`);
                    // Reiniciar el juego
                    this.elements = [];
                    this.score = 0;
                    this.activeElements.clear();
                    this.elementsContainer.innerHTML = '';
                }, 100);
            }

            getRandomColor() {
                const colors = ['#FF4136', '#2ECC40', '#0074D9', '#FF851B', '#B10DC9'];
                return colors[Math.floor(Math.random() * colors.length)];
            }
        }
    
        // Inicializar el juego al cargar la página
        window.onload = () => {
            const game = new Game();
            game.init();
        };
    </script>
    <script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>
</body>
</html>
